<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Números interactivos 1–100</title>

  <!-- PWA (ajustado para GitHub Pages en /Carta-Nomo/) -->
  <link rel="manifest" href="/Carta-Nomo/manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="apple-touch-icon" href="/Carta-Nomo/icons/icon-192.png" />
  <link rel="icon" href="/Carta-Nomo/favicon.ico" />

  <style>
    :root { --bg:#fff; --card:#f6f7f8; --accent:#0b5fff; --hover:#e8f1ff; }
    body { font-family: system-ui, sans-serif; background: var(--bg); color:#111; margin: 20px; }
    h1 { text-align:center; margin-bottom:10px; }
    .hint { text-align:center; color:#555; margin: 4px 0 16px; font-size: .95rem; }
    .editor {
      max-width: 900px; margin: 0 auto 18px; padding: 12px;
      background: var(--card); border-radius: 12px;
      display: grid; gap: 10px; grid-template-columns: 1fr 2fr 2fr auto;
      align-items: end;
    }
    .editor label { font-size: .85rem; color:#333; display:block; margin-bottom:4px; }
    .editor input[type="number"],
    .editor input[type="text"] { width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; }
    .editor input[type="file"] { width:100%; }
    .editor button {
      padding: 10px 14px; border: none; border-radius: 10px; cursor: pointer;
      background: var(--accent); color: white; font-weight: 600;
    }
    .grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 10px; max-width: 900px; margin: auto; }
    .number {
      padding: 12px; background: #f0f0f0; border-radius: 10px; cursor: pointer;
      font-weight: 700; text-align:center; user-select:none;
      transition: background .15s ease;
    }
    .number:hover { background: var(--hover); }
    .selected { outline: 2px solid var(--accent); background: #eef3ff; }
    #output { margin: 18px auto 0; font-size: 1.2rem; max-width: 900px; }
    .image-preview { max-width: 120px; margin-top: 8px; border-radius: 8px; }
    .toolbar { max-width:900px; margin: 0 auto 8px; display:flex; gap:12px; align-items:center; }
    .toolbar button { padding:6px 10px; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Carta Nomo Sarria</h1>
  <p class="hint">Clic en un número = oír y mostrar. Usa el panel de abajo para asignar/editar palabra e imagen.</p>

  <!-- Panel de edición -->
  <div class="editor" id="editor">
    <div>
      <label for="numSel">Número</label>
      <input type="number" id="numSel" min="1" max="100" value="1" />
    </div>
    <div>
      <label for="palabra">Palabra</label>
      <input type="text" id="palabra" placeholder="Escribe la palabra…" />
    </div>
    <div>
      <label for="imagen">Imagen (opcional)</label>
      <input type="file" id="imagen" accept="image/*" />
    </div>
    <div>
      <button id="guardarBtn">Guardar</button>
    </div>
  </div>

  <div class="toolbar">
    <button id="borrarBtn" title="Borra palabra e imagen del número seleccionado">Borrar número</button>
    <button id="exportBtn" title="Exporta todos tus datos como JSON">Exportar</button>
    <button id="importBtn" title="Importa un JSON previamente exportado">Importar</button>
  </div>

  <div class="grid" id="grid"></div>
  <div id="output"></div>

  <script>
    const grid     = document.getElementById("grid");
    const output   = document.getElementById("output");
    const numSel   = document.getElementById("numSel");
    const palabraI = document.getElementById("palabra");
    const imgI     = document.getElementById("imagen");
    const guardar  = document.getElementById("guardarBtn");
    const borrar   = document.getElementById("borrarBtn");
    const exportB  = document.getElementById("exportBtn");
    const importB  = document.getElementById("importBtn");

    let datos = JSON.parse(localStorage.getItem("palabrasNumeros")) || {};
    let seleccionado = 1;

    const guardarDatos = () =>
      localStorage.setItem("palabrasNumeros", JSON.stringify(datos));

    function hablar(texto) {
      try {
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(texto);
        u.lang = "es-ES";
        speechSynthesis.speak(u);
      } catch (_) {}
    }

    function pintarSeleccion() {
      [...grid.children].forEach((el, idx) => {
        const n = idx + 1;
        el.classList.toggle("selected", n === seleccionado);
      });
      numSel.value = seleccionado;
      // Rellena el panel con lo que ya hay
      const info = datos[seleccionado] || {};
      palabraI.value = info.palabra || "";
      imgI.value = ""; // no se puede pre-cargar por seguridad
    }

    function mostrar(i, hablarAhora = true) {
      const info = datos[i];
      if (!info) {
        output.innerHTML = `<strong>Número ${i}:</strong> (sin datos)`;
        return;
      }
      output.innerHTML = `<strong>Número ${i}:</strong> ${info.palabra || ""}`;
      if (info.imagen) {
        output.innerHTML += `<div><img src="${info.imagen}" class="image-preview" /></div>`;
      }
      if (hablarAhora && info.palabra) hablar(info.palabra);
    }

    // Construye la cuadrícula 1–100
    for (let i = 1; i <= 100; i++) {
      const div = document.createElement("div");
      div.className = "number";
      div.textContent = i;

      div.onclick = () => {
        seleccionado = i;
        pintarSeleccion();
        mostrar(i, true); // solo habla/muestra, no edita ni abre nada
      };

      grid.appendChild(div);
    }

    // Estado inicial
    pintarSeleccion();
    mostrar(seleccionado, false);

    // Cambiar número desde el input
    numSel.addEventListener("change", () => {
      const v = Math.max(1, Math.min(100, parseInt(numSel.value || "1", 10)));
      seleccionado = v;
      pintarSeleccion();
      mostrar(v, false);
    });

    // Guardar (palabra + imagen opcional)
    guardar.addEventListener("click", () => {
      const palabra = (palabraI.value || "").trim();
      const actualizar = (imagenDataURL = null) => {
        const anterior = datos[seleccionado]?.imagen || null;
        datos[seleccionado] = { palabra, imagen: imagenDataURL ?? anterior };
        guardarDatos();
        pintarSeleccion();
        mostrar(seleccionado, true);
      };

      const file = imgI.files && imgI.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => actualizar(reader.result);
        reader.readAsDataURL(file);
      } else {
        actualizar(null);
      }
    });

    // Borrar datos del número seleccionado
    borrar.addEventListener("click", () => {
      if (datos[seleccionado]) {
        delete datos[seleccionado];
        guardarDatos();
        pintarSeleccion();
        mostrar(seleccionado, false);
      }
    });

    // Exportar/Importar JSON
    exportB.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(datos)], { type: "application/json" });
      const url  = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "palabrasNumeros.json"; a.click();
      URL.revokeObjectURL(url);
    });

    importB.addEventListener("click", () => {
      const inp = document.createElement("input");
      inp.type = "file"; inp.accept = "application/json";
      inp.onchange = () => {
        const f = inp.files[0];
        if (!f) return;
        const r = new FileReader();
        r.onload = () => {
          try {
            const obj = JSON.parse(r.result);
            if (typeof obj === "object" && obj) {
              datos = obj;
              guardarDatos();
              pintarSeleccion();
              mostrar(seleccionado, false);
            }
          } catch (e) { alert("Archivo JSON no válido"); }
        };
        r.readAsText(f);
      };
      document.body.appendChild(inp);
      inp.click();
      inp.remove();
    });
  </script>

  <!-- Service Worker en /Carta-Nomo/ -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/Carta-Nomo/service-worker.js");
      });
    }
  </script>
</body>
</html>
