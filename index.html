<script>
// ===== Configura tus credenciales =====
const ADMIN_EMAIL = "admin@tu-dominio.com";
const ADMIN_PASS_HASH = "1ef1870f76d31f4b5e877996faf904fd5214135c9967100ff3eda9f568b4d751"; // ver cómo generarlo más abajo

// ===== Utilidad SHA‑256 =====
async function sha256(text) {
  const enc = new TextEncoder().encode(text);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2,"0")).join("");
}

// ===== Referencias UI =====
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const editarBtn = document.getElementById("editarBtn");
const borrarBtn = document.getElementById("borrarBtn");
const userInfo = document.getElementById("userInfo");

const loginBackdrop = document.getElementById("loginBackdrop");
const loginEmail = document.getElementById("loginEmail");
const loginPass  = document.getElementById("loginPass");
const loginSubmit= document.getElementById("loginSubmit");
const loginCancel= document.getElementById("loginCancel");

// ===== Estado de sesión (localStorage) =====
function isLogged(){ return localStorage.getItem("adminLogged")==="1"; }
function setLogged(v){ localStorage.setItem("adminLogged", v?"1":"0"); renderAuthUI(); }
function renderAuthUI(){
  const on = isLogged();
  editarBtn.style.display = on ? "" : "none";
  borrarBtn.style.display = on ? "" : "none";
  logoutBtn.style.display = on ? "" : "none";
  loginBtn.style.display = on ? "none" : "";
  userInfo.textContent = on ? `Sesión: ${ADMIN_EMAIL}` : "Sesión: invitado (solo lectura)";
}
renderAuthUI();

// ===== Abrir/cerrar modal =====
function openLogin(){ loginEmail.value=""; loginPass.value=""; loginBackdrop.style.display="flex"; loginBackdrop.setAttribute("aria-hidden","false"); }
function closeLogin(){ loginBackdrop.style.display="none"; loginBackdrop.setAttribute("aria-hidden","true"); }

loginBtn.onclick = openLogin;
loginCancel.onclick = closeLogin;
loginBackdrop.addEventListener("click", e => { if(e.target===loginBackdrop) closeLogin(); });

// ===== Validar e iniciar sesión =====
loginSubmit.onclick = async () => {
  const email = (loginEmail.value||"").trim().toLowerCase();
  const pass  = loginPass.value||"";
  if(email !== ADMIN_EMAIL){ alert("Credenciales inválidas"); return; }
  const h = await sha256(pass);
  if(h !== ADMIN_PASS_HASH){ alert("Credenciales inválidas"); return; }
  setLogged(true);
  closeLogin();
};

// ===== Salir =====
logoutBtn.onclick = () => setLogged(false);

// ===== Bloquea edición si no hay sesión (si ya tienes funciones de editar/borrar, respétalo) =====
// Ejemplo: si tienes una función abrirModal(i):
// const _abrirModal = abrirModal;
// window.abrirModal = (i) => { if(!isLogged()){ alert("Inicia sesión para editar."); return; } _abrirModal(i); }
</script>
